# Meeq-stg-cfn-batch
AWSTemplateFormatVersion: '2010-09-09'
Description: AWS Bach settings

# ------------------------------------------------------------#
# Input Parameters
# ------------------------------------------------------------# 
Parameters:
  PJPrefix:
    Description: "Prefix for item name"
    Type: String
    Default: Meeq-stg
  PJEnv:
    Description: "Enviroment"
    Type: String
    Default: STG

  ParamServiceRole:
    Description: "The IAM Role for batch service"
    Type: String
    Default: "arn:aws:iam::500877970798:role/service-role/AWSBatchServiceRole"
  ParamInstanceRole:
    Description: "IAM Role for the compute resources instance"
    Type: String
    Default: "ecsInstanceRole"
  ParamImageEltres:
    Description: "Amazon Machine Image (AMI) ID"
    Type: String
    Default: 500877970798.dkr.ecr.ap-northeast-1.amazonaws.com/meeq-dev-ecr:batch-eltres
  ParamImageCommon:
    Description: "Amazon Machine Image (AMI) ID"
    Type: String
    Default: 500877970798.dkr.ecr.ap-northeast-1.amazonaws.com/meeq-dev-ecr:batch-common
  ParamImageSim:
    Description: "Amazon Machine Image (AMI) ID"
    Type: String
    Default: 500877970798.dkr.ecr.ap-northeast-1.amazonaws.com/meeq-dev-ecr:batch-sim
  ParamSubnetId1:
    Description: "The subnet of the Amazon VPC"
    Type: String
    Default: subnet-0b3c78d6a44362e12
  ParamSubnetId2:
    Description: "The subnet of the Amazon VPC"
    Type: String
    Default: subnet-00434e4629a2736b8
  ParamSecurityGroupId:
    Description: "The Id of the Security Group"
    Type: String
    Default: sg-05cc7c71e34fc3fa1

# ------------------------------------------------------------#
# Resources
# ------------------------------------------------------------#
Resources:
  # ------------------------------------------------------------#
  # Create ComputeEnvironment
  # ------------------------------------------------------------#
  BatchServerCommon:
    Type: AWS::Batch::ComputeEnvironment
    Properties: 
      ComputeEnvironmentName: !Sub "${PJPrefix}-bat-srv-common"
      Type: MANAGED
      State: ENABLED
      ServiceRole: !Ref ParamServiceRole
      ComputeResources:
        AllocationStrategy: BEST_FIT
        # BidPercentage: 50
        DesiredvCpus: 0

        # Ec2KeyPair:
        # ImageId: xxxx
        InstanceRole: !Ref ParamInstanceRole
        InstanceTypes:
        - optimal
        LaunchTemplate:
          LaunchTemplateId: !Ref LaunchTemplateCommon
          Version: !GetAtt LaunchTemplateCommon.LatestVersionNumber
        MaxvCpus: 24
        MinvCpus: 0
        # PlacementGroup: 
        SecurityGroupIds:
        - !Ref ParamSecurityGroupId
        # SpotIamFleetRole:
        Subnets:
        - !Ref ParamSubnetId1
        - !Ref ParamSubnetId2
        Type: EC2
        Tags: {"Name" : "Meeq-stg-bat-srv-common"}
    DependsOn:
    - LaunchTemplateCommon

  BatchServerEltres:
    Type: AWS::Batch::ComputeEnvironment
    Properties: 
      ComputeEnvironmentName: !Sub "${PJPrefix}-bat-srv-eltres"
      Type: MANAGED
      State: ENABLED
      ServiceRole: !Ref ParamServiceRole
      ComputeResources:
        AllocationStrategy: BEST_FIT
        # BidPercentage: 50
        DesiredvCpus: 0
        # ImageId: xxxx
        InstanceRole: !Ref ParamInstanceRole
        InstanceTypes:
        - optimal
        LaunchTemplate:
          LaunchTemplateId: !Ref LaunchTemplateEltres
          Version: !GetAtt LaunchTemplateEltres.LatestVersionNumber
        MaxvCpus: 24
        MinvCpus: 0
        SecurityGroupIds:
        - !Ref ParamSecurityGroupId
        # SpotIamFleetRole:
        Subnets:
        - !Ref ParamSubnetId1
        - !Ref ParamSubnetId2
        Type: EC2
        Tags: {"Name" : "Meeq-stg-bat-srv-eltres"}
    DependsOn:
    - LaunchTemplateEltres

#  BatchServerSonyPay:
#    Type: AWS::Batch::ComputeEnvironment
#    Properties: 
#      ComputeEnvironmentName: !Sub "${PJPrefix}-bat-srv-sonypayment"
#      Type: MANAGED
#      State: ENABLED
#      ServiceRole: !Ref ParamServiceRole
#      ComputeResources:
#        AllocationStrategy: BEST_FIT
#        # BidPercentage: 50
#        DesiredvCpus: 0
#        # ImageId: xxxx
#        InstanceRole: !Ref ParamInstanceRole
#        InstanceTypes:
#        - optimal
#        LaunchTemplate:
#          LaunchTemplateId: !Ref LaunchTemplateSonypay
#          Version: !GetAtt LaunchTemplateSonypay.LatestVersionNumber
#        MaxvCpus: 24
#        MinvCpus: 0
#        SecurityGroupIds:
#        - !Ref ParamSecurityGroupId
#        # SpotIamFleetRole:
#        Subnets:
#        - !Ref ParamSubnetId1
#        - !Ref ParamSubnetId2
#        Type: EC2
#        Tags: {"Name" : "Meeq-stg-bat-srv-sonypayment"}
#    DependsOn:
#    - LaunchTemplateSonypay
#  
#  BatchServerSim:
#    Type: AWS::Batch::ComputeEnvironment
#    Properties: 
#      ComputeEnvironmentName: !Sub "${PJPrefix}-bat-srv-sim"
#      Type: MANAGED
#      State: ENABLED
#      ServiceRole: !Ref ParamServiceRole
#      ComputeResources:
#        AllocationStrategy: BEST_FIT
#        # BidPercentage: 50
#        DesiredvCpus: 0
#        # ImageId: xxxx
#        InstanceRole: !Ref ParamInstanceRole
#        InstanceTypes:
#        - optimal
#        LaunchTemplate:
#          LaunchTemplateId: !Ref LaunchTemplateSim
#          Version: !GetAtt LaunchTemplateSim.LatestVersionNumber
#        MaxvCpus: 24
#        MinvCpus: 0
#        SecurityGroupIds:
#        - !Ref ParamSecurityGroupId
#        # SpotIamFleetRole:
#        Subnets:
#        - !Ref ParamSubnetId1
#        - !Ref ParamSubnetId2
#        Type: EC2
#        Tags: {"Name" : "Meeq-stg-bat-srv-sim"}
#    DependsOn:
#    - LaunchTemplateSim
  
  # ------------------------------------------------------------#
  # Create LaunchTemplates
  # ------------------------------------------------------------#
  LaunchTemplateCommon:
    Type: AWS::EC2::LaunchTemplate
    Properties:
      LaunchTemplateName: !Sub "${PJPrefix}-bat-tpl-common"
      LaunchTemplateData:
        BlockDeviceMappings:
          - Ebs:
              VolumeSize: 30
              VolumeType: gp2
            DeviceName: /dev/xvda
        EbsOptimized: false
        Monitoring:
          Enabled: true
        UserData:
         "Fn::Base64": !Sub |
            MIME-Version: 1.0
            Content-Type: multipart/mixed; boundary="==MYBOUNDARY=="
            
            --==MYBOUNDARY==
            Content-Type: text/cloud-config; charset="us-ascii"
            
            packages:
            - amazon-efs-utils
            
            runcmd:
            - mkdir -p /mnt/efs
            - mount -t efs fs-2a22df0a:/ /mnt/efs
            
            --==MYBOUNDARY==--
  
  LaunchTemplateEltres:
    Type: AWS::EC2::LaunchTemplate
    Properties:
      LaunchTemplateName: !Sub "${PJPrefix}-bat-tpl-eltres"
      LaunchTemplateData:
        BlockDeviceMappings:
          - Ebs:
              VolumeSize: 30
              VolumeType: gp2
            DeviceName: /dev/xvda
        EbsOptimized: false
        Monitoring:
          Enabled: true
        UserData:
         "Fn::Base64": !Sub |
            MIME-Version: 1.0
            Content-Type: multipart/mixed; boundary="==MYBOUNDARY=="
            
            --==MYBOUNDARY==
            Content-Type: text/cloud-config; charset="us-ascii"
            
            packages:
            - amazon-efs-utils
            
            runcmd:
            - mkdir -p /mnt/efs
            - mount -t efs fs-2c22df0cb:/ /mnt/efs
            
            --==MYBOUNDARY==--
  
#  LaunchTemplateSonypay:
#    Type: AWS::EC2::LaunchTemplate
#    Properties:
#      LaunchTemplateName: !Sub "${PJPrefix}-bat-tpl-sonypayment"
#      LaunchTemplateData:
#        BlockDeviceMappings:
#          - Ebs:
#              VolumeSize: 30
#              VolumeType: gp2
#            DeviceName: /dev/xvda
#        EbsOptimized: false
#        Monitoring:
#          Enabled: true
#        UserData:
#         "Fn::Base64": !Sub |
#            MIME-Version: 1.0
#            Content-Type: multipart/mixed; boundary="==MYBOUNDARY=="
#            
#            --==MYBOUNDARY==
#            Content-Type: text/cloud-config; charset="us-ascii"
#            
#            packages:
#            - amazon-efs-utils
#            
#            runcmd:
#            - mkdir -p /mnt/efs
#            - mount -t efs fs-2d22df0d:/ /mnt/efs
#            
#            --==MYBOUNDARY==--
#
#  LaunchTemplateSim:
#    Type: AWS::EC2::LaunchTemplate
#    Properties:
#      LaunchTemplateName: !Sub "${PJPrefix}-bat-tpl-sim"
#      LaunchTemplateData:
#        BlockDeviceMappings:
#          - Ebs:
#              VolumeSize: 30
#              VolumeType: gp2
#            DeviceName: /dev/xvda
#        EbsOptimized: false
#        Monitoring:
#          Enabled: true
#        UserData:
#         "Fn::Base64": !Sub |
#            MIME-Version: 1.0
#            Content-Type: multipart/mixed; boundary="==MYBOUNDARY=="
#            
#            --==MYBOUNDARY==
#            Content-Type: text/cloud-config; charset="us-ascii"
#            
#            packages:
#            - amazon-efs-utils
#            
#            runcmd:
#            - mkdir -p /mnt/efs
#            - mount -t efs fs-2b22df0b:/ /mnt/efs
#            
#            --==MYBOUNDARY==--

  # ------------------------------------------------------------#
  # Create JobQueue
  # ------------------------------------------------------------#
  BatchJobQueueCommon:
    Type: AWS::Batch::JobQueue
    Properties:
      JobQueueName: !Sub "${PJPrefix}-bat-queue-common"
      Priority: 1
      State: ENABLED
      ComputeEnvironmentOrder:
      - ComputeEnvironment: !Ref BatchServerCommon
        Order: 1
  
  BatchJobQueueEltres:
    Type: AWS::Batch::JobQueue
    Properties:
      JobQueueName: !Sub "${PJPrefix}-bat-queue-eltres"
      Priority: 1
      State: ENABLED
      ComputeEnvironmentOrder:
      - ComputeEnvironment: !Ref BatchServerEltres
        Order: 1
  
#  BatchJobQueueSonyPay:
#    Type: AWS::Batch::JobQueue
#    Properties:
#      JobQueueName: !Sub "${PJPrefix}-bat-queue-sonypayment"
#      Priority: 1
#      State: ENABLED
#      ComputeEnvironmentOrder:
#      - ComputeEnvironment: !Ref BatchServerSonyPay
#        Order: 1
#  
#  BatchJobQueueSim:
#    Type: AWS::Batch::JobQueue
#    Properties:
#      JobQueueName: !Sub "${PJPrefix}-bat-queue-sim"
#      Priority: 1
#      State: ENABLED
#      ComputeEnvironmentOrder:
#      - ComputeEnvironment: !Ref BatchServerSim
#        Order: 1

  # ------------------------------------------------------------#
  # Create JobDefinition
  # ------------------------------------------------------------#
  BatchJobDefinitionC01:
    Type: AWS::Batch::JobDefinition
    Properties: 
      JobDefinitionName: !Sub "${PJPrefix}-bat-def-c01"
      Type: container
      ContainerProperties:
        Environment: 
          - Name: SPRING_PROFILE
            Value: stg
          - Name: SYSTEM_PROPS_BATCH
            Value: -Dspring.batch.job.enabled=TRUE -Dspring.batch.job.names=jp.co.sncsp.meeq.batch.common.c01.CreateCustomerBillingDetail
        Image: !Ref ParamImageCommon
        # JobRoleArn: ""
        # InstanceType: ""
        # LinuxParameters: ""
        Memory: 512
        MountPoints:
          - ReadOnly: false
            SourceVolume: efs
            ContainerPath: /mnt/efs
        Volumes:
          - Host:
              SourcePath: /mnt/efs
            Name: efs
        Privileged: false
        ReadonlyRootFilesystem: false
        # ResourceRequirements:
        # - ResourceRequirement1
        # Ulimits:
        # - Ulimit1
        User: "root"
        Vcpus: 1
      # NodeProperties:
      #   MainNode: 1
      #   NumNodes: 1
      #   NodeRangeProperties:
      #   - TargetNodes: "0:1"
      #     Container:
      #       ContainerProperties
      # Parameters: Json
      # RetryStrategy:
      #   Attempts: 1
      # Timeout:
      #   # The time duration in seconds (measured from the job attempt's startedAt timestamp)
      #   # after which AWS Batch terminates your jobs if they have not finished
      #   # Unit: Seconds
      #   AttemptDurationSeconds: 300

  BatchJobDefinitionC02:
    Type: AWS::Batch::JobDefinition
    Properties: 
      JobDefinitionName: !Sub "${PJPrefix}-bat-def-c02"
      Type: container
      ContainerProperties:
        Environment: 
          - Name: SPRING_PROFILE
            Value: stg
          - Name: SYSTEM_PROPS_BATCH
            Value: -Dspring.batch.job.enabled=TRUE -Dspring.batch.job.names=jp.co.sncsp.meeq.batch.common.c02.CreateMonthlyCustomerBillingDetail
        Image: !Ref ParamImageCommon
        Memory: 512
        MountPoints:
          - ReadOnly: false
            SourceVolume: efs
            ContainerPath: /mnt/efs
        Volumes:
          - Host:
              SourcePath: /mnt/efs
            Name: efs
        Privileged: false
        ReadonlyRootFilesystem: false
        User: "root"
        Vcpus: 1
        
  BatchJobDefinitionC03:
    Type: AWS::Batch::JobDefinition
    Properties: 
      JobDefinitionName: !Sub "${PJPrefix}-bat-def-c03"
      Type: container
      ContainerProperties:
        Environment: 
          - Name: SPRING_PROFILE
            Value: stg
          - Name: SYSTEM_PROPS_BATCH
            Value: -Dspring.batch.job.enabled=TRUE -Dspring.batch.job.names=jp.co.sncsp.meeq.batch.common.c03.DeleteMeeqAccount
        Image: !Ref ParamImageCommon
        Memory: 512
        MountPoints:
          - ReadOnly: false
            SourceVolume: efs
            ContainerPath: /mnt/efs
        Volumes:
          - Host:
              SourcePath: /mnt/efs
            Name: efs
        Privileged: false
        ReadonlyRootFilesystem: false
        User: "root"
        Vcpus: 1
        
  BatchJobDefinitionC04:
    Type: AWS::Batch::JobDefinition
    Properties: 
      JobDefinitionName: !Sub "${PJPrefix}-bat-def-c04"
      Type: container
      ContainerProperties:
        Environment: 
          - Name: SPRING_PROFILE
            Value: stg
          - Name: SYSTEM_PROPS_BATCH
            Value: -Dspring.batch.job.enabled=TRUE -Dspring.batch.job.names=jp.co.sncsp.meeq.batch.common.c04.CreateCustomerSales
        Image: !Ref ParamImageCommon
        Memory: 512
        MountPoints:
          - ReadOnly: false
            SourceVolume: efs
            ContainerPath: /mnt/efs
        Volumes:
          - Host:
              SourcePath: /mnt/efs
            Name: efs
        Privileged: false
        ReadonlyRootFilesystem: false
        User: "root"
        Vcpus: 1
      
  BatchJobDefinitionC05:
    Type: AWS::Batch::JobDefinition
    Properties: 
      JobDefinitionName: !Sub "${PJPrefix}-bat-def-c05"
      Type: container
      ContainerProperties:
        Environment: 
          - Name: SPRING_PROFILE
            Value: stg
          - Name: SYSTEM_PROPS_BATCH
            Value: -Dspring.batch.job.enabled=TRUE -Dspring.batch.job.names=jp.co.sncsp.meeq.batch.common.c05.CreateCustomerSalesDetail
        Image: !Ref ParamImageCommon
        Memory: 512
        MountPoints:
          - ReadOnly: false
            SourceVolume: efs
            ContainerPath: /mnt/efs
        Volumes:
          - Host:
              SourcePath: /mnt/efs
            Name: efs
        Privileged: false
        ReadonlyRootFilesystem: false
        User: "root"
        Vcpus: 1

  BatchJobDefinitionC06:
    Type: AWS::Batch::JobDefinition
    Properties: 
      JobDefinitionName: !Sub "${PJPrefix}-bat-def-c06"
      Type: container
      ContainerProperties:
        Environment: 
          - Name: SPRING_PROFILE
            Value: stg
          - Name: SYSTEM_PROPS_BATCH
            Value: -Dspring.batch.job.enabled=TRUE -Dspring.batch.job.names=jp.co.sncsp.meeq.batch.common.c06.InformationSender
        Image: !Ref ParamImageCommon
        Memory: 512
        MountPoints:
          - ReadOnly: false
            SourceVolume: efs
            ContainerPath: /mnt/efs
        Volumes:
          - Host:
              SourcePath: /mnt/efs
            Name: efs
        Privileged: false
        ReadonlyRootFilesystem: false
        User: "root"
        Vcpus: 1

  BatchJobDefinitionE01:
    Type: AWS::Batch::JobDefinition
    Properties: 
      JobDefinitionName: !Sub "${PJPrefix}-bat-def-e01"
      Type: container
      ContainerProperties:
        Environment: 
          - Name: SPRING_PROFILE
            Value: stg
          - Name: SYSTEM_PROPS_BATCH
            Value: -Dspring.batch.job.enabled=TRUE -Dspring.batch.job.names=jp.co.sncsp.meeq.batch.eltres.e01.
        Image: !Ref ParamImageEltres
        Memory: 512
        MountPoints:
          - ReadOnly: false
            SourceVolume: efs
            ContainerPath: /mnt/efs
        Volumes:
          - Host:
              SourcePath: /mnt/efs
            Name: efs
        Privileged: false
        ReadonlyRootFilesystem: false
        User: "root"
        Vcpus: 1

  BatchJobDefinitionE02:
    Type: AWS::Batch::JobDefinition
    Properties: 
      JobDefinitionName: !Sub "${PJPrefix}-bat-def-e02"
      Type: container
      ContainerProperties:
        Environment: 
          - Name: SPRING_PROFILE
            Value: stg
          - Name: SYSTEM_PROPS_BATCH
            Value: -Dspring.batch.job.enabled=TRUE -Dspring.batch.job.names=jp.co.sncsp.meeq.batch.eltres.e02.
        Image: !Ref ParamImageEltres
        Memory: 512
        MountPoints:
          - ReadOnly: false
            SourceVolume: efs
            ContainerPath: /mnt/efs
        Volumes:
          - Host:
              SourcePath: /mnt/efs
            Name: efs
        Privileged: false
        ReadonlyRootFilesystem: false
        User: "root"
        Vcpus: 1

  BatchJobDefinitionE03:
    Type: AWS::Batch::JobDefinition
    Properties: 
      JobDefinitionName: !Sub "${PJPrefix}-bat-def-e03"
      Type: container
      ContainerProperties:
        Environment: 
          - Name: SPRING_PROFILE
            Value: stg
          - Name: SYSTEM_PROPS_BATCH
            Value: -Dspring.batch.job.enabled=TRUE -Dspring.batch.job.names=jp.co.sncsp.meeq.batch.eltres.e03.
        Image: !Ref ParamImageEltres
        Memory: 512
        MountPoints:
          - ReadOnly: false
            SourceVolume: efs
            ContainerPath: /mnt/efs
        Volumes:
          - Host:
              SourcePath: /mnt/efs
            Name: efs
        Privileged: false
        ReadonlyRootFilesystem: false
        User: "root"
        Vcpus: 1

  BatchJobDefinitionE04:
    Type: AWS::Batch::JobDefinition
    Properties: 
      JobDefinitionName: !Sub "${PJPrefix}-bat-def-e04"
      Type: container
      ContainerProperties:
        Environment: 
          - Name: SPRING_PROFILE
            Value: stg
          - Name: SYSTEM_PROPS_BATCH
            Value: -Dspring.batch.job.enabled=TRUE -Dspring.batch.job.names=jp.co.sncsp.meeq.batch.eltres.e04.
        Image: !Ref ParamImageEltres
        Memory: 512
        MountPoints:
          - ReadOnly: false
            SourceVolume: efs
            ContainerPath: /mnt/efs
        Volumes:
          - Host:
              SourcePath: /mnt/efs
            Name: efs
        Privileged: false
        ReadonlyRootFilesystem: false
        User: "root"
        Vcpus: 1

  BatchJobDefinitionE05:
    Type: AWS::Batch::JobDefinition
    Properties: 
      JobDefinitionName: !Sub "${PJPrefix}-bat-def-e05"
      Type: container
      ContainerProperties:
        Environment: 
          - Name: SPRING_PROFILE
            Value: stg
          - Name: SYSTEM_PROPS_BATCH
            Value: -Dspring.batch.job.enabled=TRUE -Dspring.batch.job.names=jp.co.sncsp.meeq.batch.eltres.e05.
        Image: !Ref ParamImageEltres
        Memory: 512
        MountPoints:
          - ReadOnly: false
            SourceVolume: efs
            ContainerPath: /mnt/efs
        Volumes:
          - Host:
              SourcePath: /mnt/efs
            Name: efs
        Privileged: false
        ReadonlyRootFilesystem: false
        User: "root"
        Vcpus: 1

  BatchJobDefinitionE06:
    Type: AWS::Batch::JobDefinition
    Properties: 
      JobDefinitionName: !Sub "${PJPrefix}-bat-def-e06"
      Type: container
      ContainerProperties:
        Environment: 
          - Name: SPRING_PROFILE
            Value: stg
          - Name: SYSTEM_PROPS_BATCH
            Value: -Dspring.batch.job.enabled=TRUE -Dspring.batch.job.names=jp.co.sncsp.meeq.batch.eltres.e06.
        Image: !Ref ParamImageEltres
        Memory: 512
        MountPoints:
          - ReadOnly: false
            SourceVolume: efs
            ContainerPath: /mnt/efs
        Volumes:
          - Host:
              SourcePath: /mnt/efs
            Name: efs
        Privileged: false
        ReadonlyRootFilesystem: false
        User: "root"
        Vcpus: 1

  BatchJobDefinitionE07:
    Type: AWS::Batch::JobDefinition
    Properties: 
      JobDefinitionName: !Sub "${PJPrefix}-bat-def-e07"
      Type: container
      ContainerProperties:
        Environment: 
          - Name: SPRING_PROFILE
            Value: stg
          - Name: SYSTEM_PROPS_BATCH
            Value: -Dspring.batch.job.enabled=TRUE -Dspring.batch.job.names=jp.co.sncsp.meeq.batch.eltres.e07.
        Image: !Ref ParamImageEltres
        Memory: 512
        MountPoints:
          - ReadOnly: false
            SourceVolume: efs
            ContainerPath: /mnt/efs
        Volumes:
          - Host:
              SourcePath: /mnt/efs
            Name: efs
        Privileged: false
        ReadonlyRootFilesystem: false
        User: "root"
        Vcpus: 1

  BatchJobDefinitionE08:
    Type: AWS::Batch::JobDefinition
    Properties: 
      JobDefinitionName: !Sub "${PJPrefix}-bat-def-e08"
      Type: container
      ContainerProperties:
        Environment: 
          - Name: SPRING_PROFILE
            Value: stg
          - Name: SYSTEM_PROPS_BATCH
            Value: -Dspring.batch.job.enabled=TRUE -Dspring.batch.job.names=jp.co.sncsp.meeq.batch.eltres.e08.
        Image: !Ref ParamImageEltres
        Memory: 512
        MountPoints:
          - ReadOnly: false
            SourceVolume: efs
            ContainerPath: /mnt/efs
        Volumes:
          - Host:
              SourcePath: /mnt/efs
            Name: efs
        Privileged: false
        ReadonlyRootFilesystem: false
        User: "root"
        Vcpus: 1

  BatchJobDefinitionE09:
    Type: AWS::Batch::JobDefinition
    Properties: 
      JobDefinitionName: !Sub "${PJPrefix}-bat-def-e09"
      Type: container
      ContainerProperties:
        Environment: 
          - Name: SPRING_PROFILE
            Value: stg
          - Name: SYSTEM_PROPS_BATCH
            Value: -Dspring.batch.job.enabled=TRUE -Dspring.batch.job.names=jp.co.sncsp.meeq.batch.eltres.e09.
        Image: !Ref ParamImageEltres
        Memory: 512
        MountPoints:
          - ReadOnly: false
            SourceVolume: efs
            ContainerPath: /mnt/efs
        Volumes:
          - Host:
              SourcePath: /mnt/efs
            Name: efs
        Privileged: false
        ReadonlyRootFilesystem: false
        User: "root"
        Vcpus: 1

  BatchJobDefinitionE10:
    Type: AWS::Batch::JobDefinition
    Properties: 
      JobDefinitionName: !Sub "${PJPrefix}-bat-def-e10"
      Type: container
      ContainerProperties:
        Environment: 
          - Name: SPRING_PROFILE
            Value: stg
          - Name: SYSTEM_PROPS_BATCH
            Value: -Dspring.batch.job.enabled=TRUE -Dspring.batch.job.names=jp.co.sncsp.meeq.batch.eltres.e10.
        Image: !Ref ParamImageEltres
        Memory: 512
        MountPoints:
          - ReadOnly: false
            SourceVolume: efs
            ContainerPath: /mnt/efs
        Volumes:
          - Host:
              SourcePath: /mnt/efs
            Name: efs
        Privileged: false
        ReadonlyRootFilesystem: false
        User: "root"
        Vcpus: 1
#
#  BatchJobDefinitionS01:
#    Type: AWS::Batch::JobDefinition
#    Properties: 
#      JobDefinitionName: !Sub "${PJPrefix}-bat-def-s01"
#      Type: container
#      ContainerProperties:
#        Environment: 
#          - Name: SPRING_PROFILE
#            Value: stg
#          - Name: SYSTEM_PROPS_BATCH
#            Value: -Dspring.batch.job.enabled=TRUE -Dspring.batch.job.names=jp.co.sncsp.meeq.batch.common.s01.OutgoingCardPaymentRequest
#        Image: !Ref ParamImageCommon
#        Memory: 512
#        MountPoints:
#          - ReadOnly: false
#            SourceVolume: efs
#            ContainerPath: /mnt/efs
#        Volumes:
#          - Host:
#              SourcePath: /mnt/efs
#            Name: efs
#        Privileged: false
#        ReadonlyRootFilesystem: false
#        User: "root"
#        Vcpus: 1
#  
#  BatchJobDefinitionS02:
#    Type: AWS::Batch::JobDefinition
#    Properties: 
#      JobDefinitionName: !Sub "${PJPrefix}-bat-def-s02"
#      Type: container
#      ContainerProperties:
#        Environment: 
#          - Name: SPRING_PROFILE
#            Value: stg
#          - Name: SYSTEM_PROPS_BATCH
#            Value: -Dspring.batch.job.enabled=TRUE -Dspring.batch.job.names=jp.co.sncsp.meeq.batch.common.s02.IncomingCardUpdate
#        Image: !Ref ParamImageCommon
#        Memory: 512
#        MountPoints:
#          - ReadOnly: false
#            SourceVolume: efs
#            ContainerPath: /mnt/efs
#        Volumes:
#          - Host:
#              SourcePath: /mnt/efs
#            Name: efs
#        Privileged: false
#        ReadonlyRootFilesystem: false
#        User: "root"
#        Vcpus: 1
#
#  BatchJobDefinitionS03:
#    Type: AWS::Batch::JobDefinition
#    Properties: 
#      JobDefinitionName: !Sub "${PJPrefix}-bat-def-s03"
#      Type: container
#      ContainerProperties:
#        Environment: 
#          - Name: SPRING_PROFILE
#            Value: stg
#          - Name: SYSTEM_PROPS_BATCH
#            Value: -Dspring.batch.job.enabled=TRUE -Dspring.batch.job.names=jp.co.sncsp.meeq.batch.common.s03.IncomingCardPaymentResult
#        Image: !Ref ParamImageCommon
#        Memory: 512
#        MountPoints:
#          - ReadOnly: false
#            SourceVolume: efs
#            ContainerPath: /mnt/efs
#        Volumes:
#          - Host:
#              SourcePath: /mnt/efs
#            Name: efs
#        Privileged: false
#        ReadonlyRootFilesystem: false
#        User: "root"
#        Vcpus: 1
#        
#  BatchJobDefinitionM01:
#    Type: AWS::Batch::JobDefinition
#    Properties: 
#      JobDefinitionName: !Sub "${PJPrefix}-bat-def-m01"
#      Type: container
#      ContainerProperties:
#        Environment: 
#          - Name: SPRING_PROFILE
#            Value: stg
#          - Name: SYSTEM_PROPS_BATCH
#            Value: -Dspring.batch.job.enabled=TRUE -Dspring.batch.job.names=jp.co.sncsp.meeq.batch.sim.m01.ExtractExpiredPrepaidSim
#        Image: !Ref ParamImageSim
#        Memory: 512
#        MountPoints:
#          - ReadOnly: false
#            SourceVolume: efs
#            ContainerPath: /mnt/efs
#        Volumes:
#          - Host:
#              SourcePath: /mnt/efs
#            Name: efs
#        Privileged: false
#        ReadonlyRootFilesystem: false
#        User: "root"
#        Vcpus: 1
#        
#  BatchJobDefinitionM02:
#    Type: AWS::Batch::JobDefinition
#    Properties: 
#      JobDefinitionName: !Sub "${PJPrefix}-bat-def-m02"
#      Type: container
#      ContainerProperties:
#        Environment: 
#          - Name: SPRING_PROFILE
#            Value: stg
#          - Name: SYSTEM_PROPS_BATCH
#            Value: -Dspring.batch.job.enabled=TRUE -Dspring.batch.job.names=jp.co.sncsp.meeq.batch.sim.m02.OutgoingSimStopRestart
#        Image: !Ref ParamImageSim
#        Memory: 512
#        MountPoints:
#          - ReadOnly: false
#            SourceVolume: efs
#            ContainerPath: /mnt/efs
#        Volumes:
#          - Host:
#              SourcePath: /mnt/efs
#            Name: efs
#        Privileged: false
#        ReadonlyRootFilesystem: false
#        User: "root"
#        Vcpus: 1
#        
#  BatchJobDefinitionM03:
#    Type: AWS::Batch::JobDefinition
#    Properties: 
#      JobDefinitionName: !Sub "${PJPrefix}-bat-def-m03"
#      Type: container
#      ContainerProperties:
#        Environment: 
#          - Name: SPRING_PROFILE
#            Value: stg
#          - Name: SYSTEM_PROPS_BATCH
#            Value: -Dspring.batch.job.enabled=TRUE -Dspring.batch.job.names=jp.co.sncsp.meeq.batch.sim.m03.OutgoingSimQuit
#        Image: !Ref ParamImageSim
#        Memory: 512
#        MountPoints:
#          - ReadOnly: false
#            SourceVolume: efs
#            ContainerPath: /mnt/efs
#        Volumes:
#          - Host:
#              SourcePath: /mnt/efs
#            Name: efs
#        Privileged: false
#        ReadonlyRootFilesystem: false
#        User: "root"
#        Vcpus: 1
#        
#  BatchJobDefinitionM04:
#    Type: AWS::Batch::JobDefinition
#    Properties: 
#      JobDefinitionName: !Sub "${PJPrefix}-bat-def-m04"
#      Type: container
#      ContainerProperties:
#        Environment: 
#          - Name: SPRING_PROFILE
#            Value: stg
#          - Name: SYSTEM_PROPS_BATCH
#            Value: -Dspring.batch.job.enabled=TRUE -Dspring.batch.job.names=jp.co.sncsp.meeq.batch.sim.m04.OutgoingSimEntry
#        Image: !Ref ParamImageSim
#        Memory: 512
#        MountPoints:
#          - ReadOnly: false
#            SourceVolume: efs
#            ContainerPath: /mnt/efs
#        Volumes:
#          - Host:
#              SourcePath: /mnt/efs
#            Name: efs
#        Privileged: false
#        ReadonlyRootFilesystem: false
#        User: "root"
#        Vcpus: 1
#        
#  BatchJobDefinition5:
#    Type: AWS::Batch::JobDefinition
#    Properties: 
#      JobDefinitionName: !Sub "${PJPrefix}-bat-def-m05"
#      Type: container
#      ContainerProperties:
#        Environment: 
#          - Name: SPRING_PROFILE
#            Value: stg
#          - Name: SYSTEM_PROPS_BATCH
#            Value: -Dspring.batch.job.enabled=TRUE -Dspring.batch.job.names=jp.co.sncsp.meeq.batch.sim.m05.IncomingSimEntry
#        Image: !Ref ParamImageSim
#        Memory: 512
#        MountPoints:
#          - ReadOnly: false
#            SourceVolume: efs
#            ContainerPath: /mnt/efs
#        Volumes:
#          - Host:
#              SourcePath: /mnt/efs
#            Name: efs
#        Privileged: false
#        ReadonlyRootFilesystem: false
#        User: "root"
#        Vcpus: 1
#        
#  BatchJobDefinitionM06:
#    Type: AWS::Batch::JobDefinition
#    Properties: 
#      JobDefinitionName: !Sub "${PJPrefix}-bat-def-m06"
#      Type: container
#      ContainerProperties:
#        Environment: 
#          - Name: SPRING_PROFILE
#            Value: stg
#          - Name: SYSTEM_PROPS_BATCH
#            Value: -Dspring.batch.job.enabled=TRUE -Dspring.batch.job.names=jp.co.sncsp.meeq.batch.sim.m06.OutgoingSimPlanChange
#        Image: !Ref ParamImageSim
#        Memory: 512
#        MountPoints:
#          - ReadOnly: false
#            SourceVolume: efs
#            ContainerPath: /mnt/efs
#        Volumes:
#          - Host:
#              SourcePath: /mnt/efs
#            Name: efs
#        Privileged: false
#        ReadonlyRootFilesystem: false
#        User: "root"
#        Vcpus: 1
#        
#  BatchJobDefinitionM07:
#    Type: AWS::Batch::JobDefinition
#    Properties: 
#      JobDefinitionName: !Sub "${PJPrefix}-bat-def-m07"
#      Type: container
#      ContainerProperties:
#        Environment: 
#          - Name: SPRING_PROFILE
#            Value: stg
#          - Name: SYSTEM_PROPS_BATCH
#            Value: -Dspring.batch.job.enabled=TRUE -Dspring.batch.job.names=jp.co.sncsp.meeq.batch.sim.m07.IncomingSimActivate
#        Image: !Ref ParamImageSim
#        Memory: 512
#        MountPoints:
#          - ReadOnly: false
#            SourceVolume: efs
#            ContainerPath: /mnt/efs
#        Volumes:
#          - Host:
#              SourcePath: /mnt/efs
#            Name: efs
#        Privileged: false
#        ReadonlyRootFilesystem: false
#        User: "root"
#        Vcpus: 1
#        
#  BatchJobDefinitionM08:
#    Type: AWS::Batch::JobDefinition
#    Properties: 
#      JobDefinitionName: !Sub "${PJPrefix}-bat-def-m08"
#      Type: container
#      ContainerProperties:
#        Environment: 
#          - Name: SPRING_PROFILE
#            Value: stg
#          - Name: SYSTEM_PROPS_BATCH
#            Value: -Dspring.batch.job.enabled=TRUE -Dspring.batch.job.names=jp.co.sncsp.meeq.batch.sim.m08.AggregateDailyContractLine
#        Image: !Ref ParamImageSim
#        Memory: 512
#        MountPoints:
#        - ReadOnly: false
#          SourceVolume: efs
#          ContainerPath: /mnt/efs
#        Volumes:
#        - Host:
#            SourcePath: /mnt/efs
#          Name: efs
#        Privileged: false
#        ReadonlyRootFilesystem: false
#        User: "root"
#        Vcpus: 1
#        
#  BatchJobDefinitionM09:
#    Type: AWS::Batch::JobDefinition
#    Properties: 
#      JobDefinitionName: !Sub "${PJPrefix}-bat-def-m09"
#      Type: container
#      ContainerProperties:
#        Command:
#          - SYSTEM_PROPS_BATCH="-Dspring.batch.job.enabled=TRUE -Dspring.batch.job.names=jp.co.sncsp.meeq.batch.sim.m09.AggregateMonthlyContractLine"
#        Environment: 
#          - Name: SPRING_PROFILE
#            Value: stg
#          - Name: SYSTEM_PROPS_BATCH
#            Value: -Dspring.batch.job.enabled=TRUE -Dspring.batch.job.names=jp.co.sncsp.meeq.batch.sim.m09.AggregateMonthlyContractLine
#        Image: !Ref ParamImageSim
#        Memory: 512
#        MountPoints:
#        - ReadOnly: false
#          SourceVolume: efs
#          ContainerPath: /mnt/efs
#        Volumes:
#        - Host:
#            SourcePath: /mnt/efs
#          Name: efs
#        Privileged: false
#        ReadonlyRootFilesystem: false
#        User: "root"
#        Vcpus: 1
#        
#  BatchJobDefinitionM10:
#    Type: AWS::Batch::JobDefinition
#    Properties: 
#      JobDefinitionName: !Sub "${PJPrefix}-bat-def-m10"
#      Type: container
#      ContainerProperties:
#        Environment: 
#          - Name: SPRING_PROFILE
#            Value: stg
#          - Name: SYSTEM_PROPS_BATCH
#            Value: -Dspring.batch.job.enabled=TRUE -Dspring.batch.job.names=jp.co.sncsp.meeq.batch.sim.m10.AggregateDailyLineTrafficUsed
#        Image: !Ref ParamImageSim
#        Memory: 512
#        MountPoints:
#        - ReadOnly: false
#          SourceVolume: efs
#          ContainerPath: /mnt/efs
#        Volumes:
#        - Host:
#            SourcePath: /mnt/efs
#          Name: efs
#        Privileged: false
#        ReadonlyRootFilesystem: false
#        User: "root"
#        Vcpus: 1
#        
#  BatchJobDefinitionM11:
#    Type: AWS::Batch::JobDefinition
#    Properties: 
#      JobDefinitionName: !Sub "${PJPrefix}-bat-def-m11"
#      Type: container
#      ContainerProperties:
#        Environment: 
#          - Name: SPRING_PROFILE
#            Value: stg
#          - Name: SYSTEM_PROPS_BATCH
#            Value: -Dspring.batch.job.enabled=TRUE -Dspring.batch.job.names=jp.co.sncsp.meeq.batch.sim.m11.AggregateMonthlyLineTrafficUsed
#        Image: !Ref ParamImageSim
#        Memory: 512
#        MountPoints:
#        - ReadOnly: false
#          SourceVolume: efs
#          ContainerPath: /mnt/efs
#        Volumes:
#        - Host:
#            SourcePath: /mnt/efs
#          Name: efs
#        Privileged: false
#        ReadonlyRootFilesystem: false
#        User: "root"
#        Vcpus: 1
#        
#  BatchJobDefinitionM12:
#    Type: AWS::Batch::JobDefinition
#    Properties: 
#      JobDefinitionName: !Sub "${PJPrefix}-bat-def-m12"
#      Type: container
#      ContainerProperties:
#        Environment: 
#          - Name: SPRING_PROFILE
#            Value: stg
#          - Name: SYSTEM_PROPS_BATCH
#            Value: -Dspring.batch.job.enabled=TRUE -Dspring.batch.job.names=jp.co.sncsp.meeq.batch.sim.m12.AggregateDailyTotalTrafficUsed
#        Image: !Ref ParamImageSim
#        Memory: 512
#        MountPoints:
#        - ReadOnly: false
#          SourceVolume: efs
#          ContainerPath: /mnt/efs
#        Volumes:
#        - Host:
#            SourcePath: /mnt/efs
#          Name: efs
#        Privileged: false
#        ReadonlyRootFilesystem: false
#        User: "root"
#        Vcpus: 1
#        
#  BatchJobDefinitionM13:
#    Type: AWS::Batch::JobDefinition
#    Properties: 
#      JobDefinitionName: !Sub "${PJPrefix}-bat-def-m13"
#      Type: container
#      ContainerProperties:
#        Environment: 
#          - Name: SPRING_PROFILE
#            Value: stg
#          - Name: SYSTEM_PROPS_BATCH
#            Value: -Dspring.batch.job.enabled=TRUE -Dspring.batch.job.names=jp.co.sncsp.meeq.batch.sim.m13.AggregateMonthlyTotalTrafficUsed
#        Image: !Ref ParamImageSim
#        Memory: 512
#        MountPoints:
#        - ReadOnly: false
#          SourceVolume: efs
#          ContainerPath: /mnt/efs
#        Volumes:
#        - Host:
#            SourcePath: /mnt/efs
#          Name: efs
#        Privileged: false
#        ReadonlyRootFilesystem: false
#        User: "root"
#        Vcpus: 1
#        
#  BatchJobDefinitionM14:
#    Type: AWS::Batch::JobDefinition
#    Properties: 
#      JobDefinitionName: !Sub "${PJPrefix}-bat-def-m14"
#      Type: container
#      ContainerProperties:
#        Environment: 
#          - Name: SPRING_PROFILE
#            Value: stg
#          - Name: SYSTEM_PROPS_BATCH
#            Value: -Dspring.batch.job.enabled=TRUE -Dspring.batch.job.names=jp.co.sncsp.meeq.batch.sim.m14.AggregateWeeklyTotalTrafficUsed
#        Image: !Ref ParamImageSim
#        Memory: 512
#        MountPoints:
#        - ReadOnly: false
#          SourceVolume: efs
#          ContainerPath: /mnt/efs
#        Volumes:
#        - Host:
#            SourcePath: /mnt/efs
#          Name: efs
#        Privileged: false
#        ReadonlyRootFilesystem: false
#        User: "root"
#        Vcpus: 1
#        
#  BatchJobDefinitionM15:
#    Type: AWS::Batch::JobDefinition
#    Properties: 
#      JobDefinitionName: !Sub "${PJPrefix}-bat-def-m15"
#      Type: container
#      ContainerProperties:
#        Environment: 
#          - Name: SPRING_PROFILE
#            Value: stg
#          - Name: SYSTEM_PROPS_BATCH
#            Value: -Dspring.batch.job.enabled=TRUE -Dspring.batch.job.names=jp.co.sncsp.meeq.batch.sim.m15.Aggregate30DayTotalTrafficUsed
#        Image: !Ref ParamImageSim
#        Memory: 512
#        MountPoints:
#        - ReadOnly: false
#          SourceVolume: efs
#          ContainerPath: /mnt/efs
#        Volumes:
#        - Host:
#            SourcePath: /mnt/efs
#          Name: efs
#        Privileged: false
#        ReadonlyRootFilesystem: false
#        User: "root"
#        Vcpus: 1
#        
#  BatchJobDefinitionM16:
#    Type: AWS::Batch::JobDefinition
#    Properties: 
#      JobDefinitionName: !Sub "${PJPrefix}-bat-def-m16"
#      Type: container
#      ContainerProperties:
#        Environment: 
#          - Name: SPRING_PROFILE
#            Value: stg
#          - Name: SYSTEM_PROPS_BATCH
#            Value: -Dspring.batch.job.enabled=TRUE -Dspring.batch.job.names=jp.co.sncsp.meeq.batch.sim.m16.AggregateDailyLimitStatus"
#        Image: !Ref ParamImageSim
#        Memory: 512
#        MountPoints:
#        - ReadOnly: false
#          SourceVolume: efs
#          ContainerPath: /mnt/efs
#        Volumes:
#        - Host:
#            SourcePath: /mnt/efs
#          Name: efs
#        Privileged: false
#        ReadonlyRootFilesystem: false
#        User: "root"
#        Vcpus: 1
#        
#  BatchJobDefinitionM17:
#    Type: AWS::Batch::JobDefinition
#    Properties: 
#      JobDefinitionName: !Sub "${PJPrefix}-bat-def-m17"
#      Type: container
#      ContainerProperties:
#        Environment: 
#          - Name: SPRING_PROFILE
#            Value: stg
#          - Name: SYSTEM_PROPS_BATCH
#            Value: -Dspring.batch.job.enabled=TRUE -Dspring.batch.job.names=jp.co.sncsp.meeq.batch.sim.m17.AggregateMonthlyLimitStatus
#        Image: !Ref ParamImageSim
#        Memory: 512
#        MountPoints:
#        - ReadOnly: false
#          SourceVolume: efs
#          ContainerPath: /mnt/efs
#        Volumes:
#        - Host:
#            SourcePath: /mnt/efs
#          Name: efs
#        Privileged: false
#        ReadonlyRootFilesystem: false
#        User: "root"
#        Vcpus: 1
#        
# Outputs:
#   OutBatchServer:
#     Description: The ComputeEnvironment Resource
#     Value: !Ref BatchServer

#   OutBatchJobDefinition:
#     Description: The JobDefinition Resource
#     Value: !Ref BatchJobDefinition

#   OutBatchJobQueue:
#     Description: The JobQueue Resource
#     Value: !Ref BatchJobQueue